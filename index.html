<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wallet Personality (Moralis Powered)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen p-6">

<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-2xl p-6">
  <h1 class="text-3xl font-bold text-center mb-6">ðŸ§¬ Wallet Personality</h1>

  <input id="walletInput"
    class="w-full border p-3 rounded mb-4"
    placeholder="Enter wallet address" />

  <button onclick="startAnalysis()"
    class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded font-bold">
    Analyze Wallet
  </button>

  <div id="results" class="mt-6 hidden"></div>
</div>

<script>
const MORALIS_CHAINS = {
  ethereum: 'eth',
  avalanche: 'avax',
  bsc: 'bsc'
};

const CHAINS = ['ethereum', 'avalanche', 'bsc'];

const personalities = {
  trader: 'ðŸ“ˆ Trader',
  defi: 'ðŸŒ¾ DeFi User',
  hodler: 'ðŸ’Ž HODLer',
  newbie: 'ðŸŒ± Newcomer'
};

async function startAnalysis() {
  const address = document.getElementById('walletInput').value.trim();
  if (!address) return alert('Enter wallet address');

  const results = [];
  for (const chain of CHAINS) {
    results.push(await analyzeChain(chain, address));
  }

  renderResults(results);
}

async function analyzeChain(chain, address) {
  const moralisChain = MORALIS_CHAINS[chain];
  if (!moralisChain) return null;

  const stats = await fetch(
    `/api/moralis?endpoint=${address}/stats?chain=${moralisChain}`
  ).then(r => r.json());

  const bal = await fetch(
    `/api/moralis?endpoint=${address}/balance?chain=${moralisChain}`
  ).then(r => r.json());

  const txCount = stats?.transactions?.total || 0;
  const balance = Number(bal.balance || 0) / 1e18;

  const personality =
    txCount > 500 ? 'trader' :
    txCount > 100 ? 'defi' :
    txCount > 10 ? 'hodler' :
    'newbie';

  return { chain, txCount, balance, personality };
}

function renderResults(results) {
  const container = document.getElementById('results');
  container.classList.remove('hidden');

  container.innerHTML = results.map(r => `
    <div class="border rounded p-3 mb-2">
      <strong>${r.chain.toUpperCase()}</strong><br/>
      ${personalities[r.personality]}<br/>
      TXs: ${r.txCount}<br/>
      Balance: ${r.balance.toFixed(4)}
    </div>
  `).join('');
}
</script>

</body>
</html>
