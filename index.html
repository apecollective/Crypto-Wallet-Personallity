<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Personality Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        #resultsScreen { display: none; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white font-sans">

    <div id="mainContainer" class="max-w-4xl mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-5xl font-extrabold mb-4 tracking-tight">Wallet Personality <span class="text-indigo-400">Scanner</span></h1>
            <p class="text-indigo-200 text-lg">Scan the multiverse. Find your true Web3 identity.</p>
        </header>

        <div id="searchBox" class="bg-indigo-900/50 p-8 rounded-3xl border border-indigo-500/30 shadow-2xl backdrop-blur-sm">
            <input type="text" id="walletAddress" placeholder="Enter EVM Address (0x...)" 
                   class="w-full p-4 rounded-xl bg-indigo-950 border border-indigo-400 text-white placeholder-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4 text-lg">
            <button onclick="startMultiverseScan()" 
                    class="w-full bg-indigo-500 hover:bg-indigo-400 transition-all p-4 rounded-xl font-bold text-xl uppercase tracking-widest shadow-lg">
                Reveal My Identity
            </button>
        </div>

        <div id="loading" class="hidden text-center py-20">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-indigo-400 border-solid mx-auto mb-4"></div>
            <p id="loadingText" class="text-xl animate-pulse">Scanning Ethereum...</p>
        </div>

        <div id="resultsScreen" class="space-y-8 animate-in fade-in duration-700">
            <div id="personalityCard" class="bg-white text-gray-900 rounded-3xl p-8 shadow-2xl relative overflow-hidden">
                <div class="relative z-10">
                    <h2 id="personalityName" class="text-4xl font-black uppercase italic mb-2 text-indigo-600">Calculating...</h2>
                    <p id="personalityDesc" class="text-gray-600 text-lg mb-6 leading-relaxed"></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-indigo-50 p-6 rounded-2xl">
                            <p class="text-sm uppercase font-bold text-indigo-400 mb-1">Total Net Worth</p>
                            <span class="text-4xl font-black text-indigo-900">$</span>
                            <span id="netWorthValue" class="text-4xl font-black text-indigo-900">0</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                            <canvas id="networkChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="downloadCard()" class="w-full bg-green-500 hover:bg-green-400 p-4 rounded-xl font-bold text-white shadow-lg transition-all">
                Download Personality Card (PNG)
            </button>
            <button onclick="location.reload()" class="w-full text-indigo-300 hover:text-white underline font-medium">Scan Another Wallet</button>
        </div>
    </div>

    <script>
        let myChart = null;
        const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub25jZSI6IjRhM2IwMjFiLTE5ODMtNGI3Ny05NThkLWNkNDhjYjFlZTczZiIsIm9yZ0lkIjoiNDg5MTEwIiwidXNlcklkIjoiNTAzMjMyIiwidHlwZUlkIjoiY2MxNDg2ODMtN2I0Zi00YmJjLWI4MzUtODBiZmMyNzEzNTA5IiwidHlwZSI6IlBST0pFQ1QiLCJpYXQiOjE3Njc3ODM1ODQsImV4cCI6NDkyMzU0MzU4NH0.iz4j7M9szIwo7_Dm97iJej-Y_TSDmZ-juM5qjXoj8S8"; // REPLACE WITH YOUR KEY
        const chainConfig = [
            { id: '0x1', name: 'Ethereum', color: '#6366f1' },
            { id: '0x38', name: 'BSC', color: '#f59e0b' },
            { id: '0x89', name: 'Polygon', color: '#8b5cf6' },
            { id: '0xa4b1', name: 'Arbitrum', color: '#3b82f6' }
        ];

        async function startMultiverseScan() {
            const address = document.getElementById('walletAddress').value.trim();
            if (!address.startsWith('0x')) return alert("Enter a valid EVM address!");

            document.getElementById('searchBox').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');

            let chainTotals = {};
            let globalUSD = 0;

            try {
                // Scan all chains in parallel
                await Promise.all(chainConfig.map(async (chain) => {
                    document.getElementById('loadingText').innerText = `Probing ${chain.name}...`;
                    const res = await fetch(`https://deep-index.moralis.io/api/v2.2/wallets/${address}/tokens?chain=${chain.id}`, {
                        headers: { 'X-API-Key': API_KEY }
                    });
                    const data = await res.json();
                    
                    let chainSum = 0;
                    data.result?.forEach(t => chainSum += parseFloat(t.usd_value || 0));
                    if (chainSum > 0) chainTotals[chain.name] = chainSum;
                    globalUSD += chainSum;
                }));

                displayResults(globalUSD, chainTotals);
            } catch (err) {
                alert("Scan failed. Check your API key or address.");
                location.reload();
            }
        }

        function displayResults(total, chainData) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');

            // 1. Animate Net Worth Counter
            animateValue(document.getElementById('netWorthValue'), 0, Math.floor(total), 2000);

            // 2. Set Personality Logic
            const nameEl = document.getElementById('personalityName');
            const descEl = document.getElementById('personalityDesc');
            
            if (total > 10000) {
                nameEl.innerText = "The Omni-Chain Whale";
                descEl.innerText = "You move markets with a single click. Your liquidity is the lifeblood of the multiverse.";
            } else if (Object.keys(chainData).length > 2) {
                nameEl.innerText = "The Bridging Nomad";
                descEl.innerText = "You hate high fees and love new frontiers. You have probably spent a fortune just on bridging gas.";
            } else {
                nameEl.innerText = "The Mainnet Loyalist";
                descEl.innerText = "Simple, clean, and classic. You stay where the security is, even if it costs a premium.";
            }

            // 3. Render Chart
            const ctx = document.getElementById('networkChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(chainData),
                    datasets: [{
                        data: Object.values(chainData),
                        backgroundColor: chainConfig.map(c => c.color),
                        borderWidth: 0
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } }, maintainAspectRatio: false }
            });
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        async function downloadCard() {
            const card = document.getElementById('personalityCard');
            const canvas = await html2canvas(card);
            const link = document.createElement('a');
            link.download = 'my-web3-personality.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
